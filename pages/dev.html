<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoDrop - Dev Bereich</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    
    <!-- Load shared scripts -->
    <script src="../config/config-secure.js"></script>
    <script src="../config/config-secrets.js"></script>
    <script src="../js/firebase.js"></script>
    <script src="../js/common.js"></script>
    <script src="../js/dev-functions.js"></script>
    <script src="../js/pool-wallet.js"></script>
    <script src="../js/upload-functions.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/exif-js@2.3.0/exif.js"></script>
    
    <script>
        // Get dev drops count function
        window.getDevDropsCount = async function() {
            try {
                console.log('ğŸ” [DEV.HTML] Getting dev drops count...');
                if (!window.db) {
                    console.log('âŒ [DEV.HTML] Firebase not ready');
                    return 0;
                }
                const devDropsSnapshot = await window.db.collection('devDrops').get();
                console.log(`ğŸ“Š [DEV.HTML] Found ${devDropsSnapshot.size} dev drops`);
                return devDropsSnapshot.size;
            } catch (error) {
                console.error('âŒ [DEV.HTML] Error getting dev drops count:', error);
                return 0;
            }
        };
        
        // Force update filename display function
        window.updateNextFilenameDisplay = async function() {
            try {
                console.log('ğŸ”„ [DEV.HTML] Updating next filename display...');
                if (!window.db) {
                    console.log('â³ [DEV.HTML] Firebase not ready, retrying in 1 second...');
                    setTimeout(() => { updateNextFilenameDisplay(); }, 1000);
                    return;
                }
                const count = await getDevDropsCount();
                const nextNumber = count + 1;
                const nextFilename = `GeoDrop${nextNumber}`;
                console.log(`ğŸ“Š [DEV.HTML] Found ${count} dev drops, next number: ${nextNumber}`);
                const displayElement = document.getElementById('next-filename-display');
                if (displayElement) {
                    displayElement.textContent = nextFilename;
                    console.log(`âœ… [DEV.HTML] Updated display element: ${nextFilename}`);
                } else {
                    console.log('âŒ [DEV.HTML] next-filename-display element not found');
                }
                const filenameInput = document.getElementById('dev-filename');
                if (filenameInput) {
                    if (!filenameInput.value || filenameInput.value === 'GeoDrop1') {
                        filenameInput.value = nextFilename;
                        console.log(`âœ… [DEV.HTML] Updated filename input: ${nextFilename}`);
                    } else {
                        console.log(`â„¹ï¸ [DEV.HTML] Filename input already has value: ${filenameInput.value}`);
                    }
                } else {
                    console.log('âŒ [DEV.HTML] dev-filename element not found');
                }
                console.log(`ğŸ“ [DEV.HTML] Next filename: ${nextFilename} (${count} existing drops)`);
            } catch (error) {
                console.error('âŒ [DEV.HTML] Error updating next filename display:', error);
            }
        };
        
        // Force update on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ”„ [DEV.HTML] DOM loaded, forcing filename update...');
            setTimeout(() => {
                updateNextFilenameDisplay();
            }, 2000);
        });
        
        // Also update when switching to upload tab
        window.addEventListener('load', function() {
            console.log('ğŸ”„ [DEV.HTML] Page fully loaded, forcing filename update...');
            setTimeout(() => {
                updateNextFilenameDisplay();
            }, 3000);
        });
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            background-color: #1a202c;
            color: #e2e8f0;
        }
        
        .dev-drop-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .dev-drop-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }
        .dev-drop-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .dev-tab {
            display: none;
        }
        .dev-tab.active {
            display: block !important;
        }
        
        .mehr-tab-btn {
            background-color: #374151;
            color: #d1d5db;
            border: 1px solid #4b5563;
            min-width: 120px;
            text-align: center;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }
        
        .mehr-tab-btn:hover {
            background-color: #4b5563;
            border-color: #6b7280;
        }
        
        .mehr-tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            color: white !important;
        }
        
        .custom-alert {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            max-width: 400px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Sidebar -->
    <nav class="fixed top-0 left-0 h-full w-64 bg-gray-800 shadow-lg z-50 overflow-y-auto hidden md:block">
        <div class="p-4">
            <div class="mb-6">
                <h1 class="text-xl font-bold text-white">ğŸŒ GeoDrop</h1>
            </div>
            <div class="space-y-2">
                <a href="../index.html" class="nav-btn w-full text-left px-4 py-3 rounded-lg text-white hover:bg-gray-700 transition-colors flex items-center">
                    <span class="mr-3">ğŸ </span> Start
                </a>
                <a href="../index.html" class="nav-btn w-full text-left px-4 py-3 rounded-lg text-white hover:bg-gray-700 transition-colors flex items-center" onclick="showPage('geocard')">
                    <span class="mr-3">ğŸ—ºï¸</span> GeoCard
                </a>
                <a href="../index.html" class="nav-btn w-full text-left px-4 py-3 rounded-lg text-white hover:bg-gray-700 transition-colors flex items-center" onclick="showPage('geoboard')">
                    <span class="mr-3">ğŸ“Š</span> GeoBoard
                </a>
                <a href="../index.html" class="nav-btn w-full text-left px-4 py-3 rounded-lg text-white hover:bg-gray-700 transition-colors flex items-center" onclick="showPage('machines')">
                    <span class="mr-3">â›ï¸</span> Mining
                </a>
                <a href="../index.html" class="nav-btn w-full text-left px-4 py-3 rounded-lg text-white hover:bg-gray-700 transition-colors flex items-center" onclick="showPage('bonus')">
                    <span class="mr-3">ğŸ</span> Bonus
                </a>
                <a href="../index.html" class="nav-btn w-full text-left px-4 py-3 rounded-lg text-white hover:bg-gray-700 transition-colors flex items-center" onclick="showPage('geochat')">
                    <span class="mr-3">ğŸ’¬</span> GeoChat
                </a>
                <a href="../index.html" class="nav-btn w-full text-left px-4 py-3 rounded-lg text-white hover:bg-gray-700 transition-colors flex items-center" onclick="showPage('trading')">
                    <span class="mr-3">ğŸ“ˆ</span> Trading
                </a>
                <a href="#" class="nav-btn w-full text-left px-4 py-3 rounded-lg text-white hover:bg-gray-700 transition-colors flex items-center bg-red-600">
                    <span class="mr-3">ğŸ”§</span> Dev
                    </a>
                </div>
        </div>
    </nav>
    
    <!-- Mobile Navigation -->
    <nav class="fixed top-0 left-0 right-0 bg-gray-800 shadow-lg z-50 md:hidden">
        <div class="p-2">
            <div class="mb-2">
                <h1 class="text-lg font-bold text-white text-center">ğŸŒ GeoDrop</h1>
                </div>
            <div class="grid grid-cols-4 gap-1">
                <a href="../index.html" class="nav-btn px-2 py-2 rounded text-white hover:bg-gray-700 transition-colors text-xs">
                    <div class="text-center">ğŸ <br>Start</div>
                </a>
                <a href="../index.html" class="nav-btn px-2 py-2 rounded text-white hover:bg-gray-700 transition-colors text-xs" onclick="showPage('geocard')">
                    <div class="text-center">ğŸ—ºï¸<br>Card</div>
                </a>
                <a href="../index.html" class="nav-btn px-2 py-2 rounded text-white hover:bg-gray-700 transition-colors text-xs" onclick="showPage('geoboard')">
                    <div class="text-center">ğŸ“Š<br>Board</div>
                </a>
                <a href="../index.html" class="nav-btn px-2 py-2 rounded text-white hover:bg-gray-700 transition-colors text-xs" onclick="showPage('machines')">
                    <div class="text-center">â›ï¸<br>Mining</div>
                </a>
                <a href="../index.html" class="nav-btn px-2 py-2 rounded text-white hover:bg-gray-700 transition-colors text-xs" onclick="showPage('bonus')">
                    <div class="text-center">ğŸ<br>Bonus</div>
                </a>
                <a href="../index.html" class="nav-btn px-2 py-2 rounded text-white hover:bg-gray-700 transition-colors text-xs" onclick="showPage('geochat')">
                    <div class="text-center">ğŸ’¬<br>Chat</div>
                </a>
                <a href="../index.html" class="nav-btn px-2 py-2 rounded text-white hover:bg-gray-700 transition-colors text-xs" onclick="showPage('trading')">
                    <div class="text-center">ğŸ“ˆ<br>Trading</div>
                </a>
                <a href="#" class="nav-btn px-2 py-2 rounded text-white hover:bg-gray-700 transition-colors text-xs bg-red-600">
                    <div class="text-center">ğŸ”§<br>Dev</div>
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="ml-0 md:ml-64 mt-16 md:mt-0">
            <div class="max-w-6xl mx-auto p-6">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold text-white">ğŸ”§ Dev-Bereich</h2>
                <div class="flex space-x-2">
                    <button onclick="showDevLoginPopup()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                        ğŸ” Dev-Login
                    </button>
                    <button onclick="logoutDev()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">
                        ğŸšª Logout
                    </button>
                </div>
            </div>
            
            <!-- Dev Status -->
            <div class="bg-gray-700 rounded-lg p-6 mb-6">
                <h3 class="text-xl font-semibold text-white mb-4">ğŸ”’ Dev-Status</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <p class="text-sm text-gray-400">Dev-Berechtigung:</p>
                        <p id="dev-status" class="text-lg font-semibold text-red-400">ğŸ”’ Dev-Berechtigung inaktiv</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-400">Aktueller Benutzer:</p>
                        <p id="current-user" class="text-lg font-semibold text-gray-300">Nicht angemeldet</p>
                    </div>
                </div>
            </div>
            
            <!-- Dev Tab Navigation -->
            <div class="flex flex-wrap justify-center gap-2 mb-6">
                <button class="mehr-tab-btn active" data-tab="dev-main" onclick="showDevTab('dev-main')">
                    ğŸ”§ Hauptbereich
                </button>
                <button class="mehr-tab-btn" data-tab="dev-upload" onclick="showDevTab('dev-upload')">
                    ğŸ“¤ Upload
                </button>
                <button class="mehr-tab-btn" data-tab="dev-drops" onclick="showDevTab('dev-drops')">
                    ğŸ¯ Drop Management
                </button>
                <button class="mehr-tab-btn" data-tab="dev-test" onclick="showDevTab('dev-test')">
                    ğŸ§ª Tests
                </button>
            </div>
            
            <!-- Dev Main Tab -->
            <div id="dev-main" class="dev-tab active">
                <div class="bg-gray-700 rounded-lg p-6">
                    <h3 class="text-xl font-semibold text-white mb-4">ğŸ”§ Dev-Hauptbereich</h3>
                    <div class="space-y-4 text-gray-300">
                        
                        <!-- Dev Drop Button -->
                        <div class="bg-gray-600 rounded-lg p-4">
                            <h4 class="text-lg font-semibold text-red-400 mb-2">ğŸ¯ Dev Drop erstellen</h4>
                            <p class="mb-3">Erstelle einen neuen Dev Drop an deinem aktuellen Standort.</p>
                            <button id="dev-drop-btn" onclick="createDevDrop()" class="dev-drop-btn" disabled>
                                ğŸ”’ Admin-Modus erforderlich
                            </button>
                        </div>
                        
                        <!-- Admin Status -->
                        <div class="bg-gray-600 rounded-lg p-4">
                            <h4 class="text-lg font-semibold text-blue-400 mb-2">ğŸ‘‘ Admin-Status</h4>
                            <div class="space-y-2">
                                <p><strong>Status:</strong> <span id="admin-status" class="text-red-400">Inaktiv</span></p>
                                <p><strong>Berechtigung:</strong> <span id="dev-permission-status" class="text-red-400">Keine Berechtigung</span></p>
                            </div>
                        </div>
                        
                        <!-- Pool Wallet Status -->
                        <div class="bg-gray-600 rounded-lg p-4">
                            <h4 class="text-lg font-semibold text-blue-400 mb-2">ğŸ¦ Pool Wallet</h4>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-300">PixelDrops:</span>
                                    <span id="pool-pixeldrops" class="text-green-400 font-semibold">LÃ¤dt...</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-300">tBNB:</span>
                                    <span id="pool-bnb" class="text-yellow-400 font-semibold">LÃ¤dt...</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-300">Pool Wallet:</span>
                                    <span class="text-gray-400 text-xs">0x6167...BC4</span>
                                </div>
                            </div>
                            <button onclick="updatePoolWalletBalances()" class="w-full mt-3 px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                                ğŸ”„ Balances aktualisieren
                            </button>
                        </div>


                        <!-- Quick Actions -->
                        <div class="bg-gray-600 rounded-lg p-4">
                            <h4 class="text-lg font-semibold text-green-400 mb-2">âš¡ Schnellaktionen</h4>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="authorizeDev()" class="px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700">
                                    âœ… Dev aktivieren
                                </button>
                                <button onclick="deauthorizeDev()" class="px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700">
                                    âŒ Dev deaktivieren
                                </button>
                            </div>
                            <div class="mt-2">
                                <button onclick="debugDevStatus()" class="w-full px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                                    ğŸ” Dev Status Debug
                                </button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            
            <!-- Dev Upload Tab -->
            <div id="dev-upload" class="dev-tab">
                <div class="bg-gray-700 rounded-lg p-6">
                    <h3 class="text-xl font-semibold text-white mb-4">ğŸ“¤ Dev Upload</h3>
                    <div class="space-y-4 text-gray-300">
                        
                        <!-- Admin Upload Section -->
                        <div id="admin-upload-section" class="bg-gray-600 rounded-lg p-4">
                            <h4 class="text-lg font-semibold text-blue-400 mb-2">ğŸ“¤ Admin Upload</h4>
                            <div class="space-y-3">
                                <div>
                                    <label for="admin-upload-type" class="block text-sm font-medium text-gray-300 mb-1">Upload-Typ:</label>
                                    <select id="admin-upload-type" class="w-full p-2 bg-gray-700 border border-gray-500 rounded text-white">
                                        <option value="config">Konfiguration</option>
                                        <option value="update">App-Update</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="admin-upload-input" class="block text-sm font-medium text-gray-300 mb-1">Datei auswÃ¤hlen:</label>
                                    <input type="file" id="admin-upload-input" class="w-full p-2 bg-gray-700 border border-gray-500 rounded text-white">
                                </div>
                                <button onclick="adminUpload()" class="w-full px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                                    ğŸ“¤ Upload starten
                                </button>
                            </div>
                        </div>


                        <!-- Bildupload Section -->
                        <div id="bildupload-section" class="bg-gray-600 rounded-lg p-4">
                            <h4 class="text-lg font-semibold text-cyan-400 mb-2">ğŸ“¸ Bild Upload mit Drop-Erstellung</h4>
                            <div class="space-y-3">
                                <div class="text-sm text-gray-300">
                                    <p><strong>NÃ¤chster Dateiname:</strong></p>
                                    <p id="next-filename-display" class="text-blue-300">LÃ¤dt...</p>
                                </div>
                                <input type="file" id="dev-image-file" accept="image/*" class="w-full p-2 bg-gray-700 border border-gray-500 rounded text-white text-sm">
                                <input type="text" id="dev-filename" placeholder="Dateiname" class="w-full p-2 bg-gray-700 border border-gray-500 rounded text-white text-sm" value="GeoDrop1">
                                
                                <!-- Beschreibung -->
                                <div>
                                    <label for="dev-drop-description" class="block text-sm font-medium text-gray-300 mb-1">ğŸ“ Beschreibung (was fotografiert werden soll):</label>
                                    <textarea id="dev-drop-description" placeholder="z.B. 'Das rote GebÃ¤ude mit dem blauen Dach' oder 'Die Statue vor dem Eingang'" class="w-full p-2 bg-gray-700 border border-gray-500 rounded text-white text-sm" rows="2"></textarea>
                                    <p class="text-xs text-gray-400 mt-1">ğŸ’¡ Diese Beschreibung wird im Popup der Karte angezeigt</p>
                                </div>
                                
                                <!-- GPS Koordinaten (optional) -->
                                <div class="bg-gray-700 rounded p-3">
                                    <h5 class="text-sm font-semibold text-yellow-400 mb-2">ğŸ“ GPS-Koordinaten (optional)</h5>
                                    <div class="grid grid-cols-2 gap-2">
                                        <div>
                                            <label for="upload-lat" class="block text-xs text-gray-300 mb-1">Breitengrad:</label>
                                            <input type="number" id="upload-lat" step="0.000001" placeholder="48.2082" class="w-full p-2 bg-gray-600 border border-yellow-500 rounded text-white text-sm">
                                        </div>
                                        <div>
                                            <label for="upload-lng" class="block text-xs text-gray-300 mb-1">LÃ¤ngengrad:</label>
                                            <input type="number" id="upload-lng" step="0.000001" placeholder="16.3738" class="w-full p-2 bg-gray-600 border border-yellow-500 rounded text-white text-sm">
                                        </div>
                                    </div>
                                    <p class="text-xs text-gray-400 mt-1">ğŸ’¡ Leer lassen = aktuelle Position verwenden</p>
                                </div>
                                
                                <button onclick="uploadDevImageWithDrop()" class="w-full px-3 py-2 bg-cyan-600 text-white rounded hover:bg-cyan-700">
                                    ğŸ“¤ Bild hochladen + Drop erstellen
                                </button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            
            <!-- Dev Drops Tab -->
            <div id="dev-drops" class="dev-tab">
                <div class="bg-gray-700 rounded-lg p-6">
                    <h3 class="text-xl font-semibold text-white mb-4">ğŸ¯ Dev Drop Management</h3>
                    <div class="space-y-4 text-gray-300">
                        
                        <!-- Dev Drop Management -->
                        <div class="bg-gray-600 rounded-lg p-4 mt-4">
                            <h4 class="text-lg font-semibold text-red-400 mb-2">ğŸ—‘ï¸ Dev Drop Management</h4>
                            <div class="space-y-2">
                                <div class="text-sm text-gray-300">
                                    <p><strong>Dev Drops lÃ¶schen:</strong></p>
                                    <p class="text-red-300">âš ï¸ Vorsicht: LÃ¶scht den Drop und das zugehÃ¶rige Bild!</p>
                                </div>
                                <select id="dev-drop-select" class="w-full p-2 bg-gray-700 border border-gray-500 rounded text-white text-sm">
                                    <option value="">Dev Drop auswÃ¤hlen...</option>
                                </select>
                                <button onclick="deleteSelectedDevDrop()" class="w-full px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700">
                                    ğŸ—‘ï¸ AusgewÃ¤hlten Dev Drop lÃ¶schen
                                </button>
                                <button onclick="loadDevDropsForDeletion()" class="w-full px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                                    ğŸ”„ Dev Drops laden
                                </button>
                                <button onclick="synchronizeDevDropsWithImages()" class="w-full px-3 py-2 bg-purple-600 text-white rounded hover:bg-purple-700">
                                    ğŸ” Dev Drops prÃ¼fen
                                </button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            
            <!-- Dev Test Tab -->
            <div id="dev-test" class="dev-tab">
                <div class="bg-gray-700 rounded-lg p-6">
                    <h3 class="text-xl font-semibold text-white mb-4">ğŸ§ª Dev Tests</h3>
                    <div class="space-y-4 text-gray-300">
                        
                        <!-- System Tests -->
                        <div class="bg-gray-600 rounded-lg p-4">
                            <h4 class="text-lg font-semibold text-blue-400 mb-2">ğŸ”§ System Tests</h4>
                            <p class="mb-3">Teste verschiedene Funktionen der Anwendung.</p>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="runAllTests()" class="px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                                    ğŸ§ª Alle Tests ausfÃ¼hren
                                </button>
                                <button onclick="debugApp()" class="px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700">
                                    ğŸ” App Debug
                                </button>
                            </div>
                        </div>

                        <!-- Location Tests -->
                        <div class="bg-gray-600 rounded-lg p-4">
                            <h4 class="text-lg font-semibold text-green-400 mb-2">ğŸ“ Location Tests</h4>
                            <div class="space-y-2">
                                <button onclick="debugLocation()" class="w-full px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700">
                                    ğŸ“ Standort-Details anzeigen
                                </button>
                                <button onclick="getCurrentLocation()" class="w-full px-3 py-2 bg-teal-600 text-white rounded hover:bg-teal-700">
                                    ğŸ¯ Aktuelle Position abrufen
                                </button>
                            </div>
                        </div>

                        <!-- Firebase Tests -->
                        <div class="bg-gray-600 rounded-lg p-4">
                            <h4 class="text-lg font-semibold text-orange-400 mb-2">ğŸ”¥ Firebase Tests</h4>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="debugFirebaseCollections()" class="px-3 py-2 bg-orange-600 text-white rounded hover:bg-orange-700">
                                    ğŸ”¥ Collections testen
                                </button>
                                <button onclick="debugAllCounters()" class="px-3 py-2 bg-purple-600 text-white rounded hover:bg-purple-700">
                                    ğŸ“Š Counter testen
                                </button>
                            </div>
                        </div>

                        <!-- Drop Tests -->
                        <div class="bg-gray-600 rounded-lg p-4">
                            <h4 class="text-lg font-semibold text-yellow-400 mb-2">ğŸ¯ Drop Tests</h4>
                            <div class="space-y-2">
                                <button onclick="resetDailyClaims()" class="w-full px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700">
                                    ğŸ”„ TÃ¤gliche Claims zurÃ¼cksetzen
                                </button>
                                <p class="text-xs text-gray-400">Setzt alle tÃ¤glichen Claims fÃ¼r den aktuellen User zurÃ¼ck</p>
                                <button onclick="addDropDescriptions()" class="w-full px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                                    ğŸ“ Beschreibungen hinzufÃ¼gen
                                </button>
                                <p class="text-xs text-gray-400">FÃ¼gt Beschreibungen zu allen Drops hinzu</p>
                                <button onclick="debugDropNumbers()" class="w-full px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700">
                                    ğŸ“Š Drop-Nummern Debug
                                </button>
                                <p class="text-xs text-gray-400">Zeigt alle bestehenden Drop-Nummern an</p>
                                <button onclick="loadGeoDrops()" class="w-full px-3 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700">
                                    ğŸ¯ GeoDrops laden
                                </button>
                                <div class="grid grid-cols-2 gap-2">
                                    <button onclick="fixOldDevDrops()" class="px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700">
                                        ğŸ”§ Dev Drops reparieren
                                    </button>
                                    <button onclick="resetDropAvailability('test')" class="px-3 py-2 bg-orange-600 text-white rounded hover:bg-orange-700">
                                        ğŸ”„ Drops zurÃ¼cksetzen
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Counter Tests -->
                        <div class="bg-gray-600 rounded-lg p-4">
                            <h4 class="text-lg font-semibold text-red-400 mb-2">ğŸ“Š Counter Tests</h4>
                            <div class="space-y-2">
                                <div class="text-sm text-gray-300">
                                    <p><strong>Bild-Upload-Counter verwalten:</strong></p>
                                    <p class="text-red-300">âš ï¸ Vorsicht: ZurÃ¼cksetzen kann zu Namenskonflikten fÃ¼hren!</p>
                                </div>
                                <button onclick="resetGeoDropCounter()" class="w-full px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700">
                                    ğŸ”„ Counter auf 1 zurÃ¼cksetzen
                                </button>
                                <button onclick="updateNextFilenameDisplay()" class="w-full px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                                    ğŸ”„ Counter-Anzeige aktualisieren
                                </button>
                            </div>
                        </div>


                        <!-- Performance Tests -->
                        <div class="bg-gray-600 rounded-lg p-4">
                            <h4 class="text-lg font-semibold text-cyan-400 mb-2">âš¡ Performance Tests</h4>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="console.log('Performance test started'); performance.now();" class="px-3 py-2 bg-cyan-600 text-white rounded hover:bg-cyan-700">
                                    âš¡ Performance messen
                                </button>
                                <button onclick="console.log('Memory usage:', performance.memory);" class="px-3 py-2 bg-teal-600 text-white rounded hover:bg-teal-700">
                                    ğŸ’¾ Speicher prÃ¼fen
                                </button>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
            
        </div>
    </main>

    <!-- Custom Alert -->
    <div id="custom-alert" class="custom-alert" style="display: none;"></div>
    
    <!-- Dev Login Popup -->
    <div id="dev-login-popup" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; display: none;">
        <div style="display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 20px;">
            <div style="background: #374151; border-radius: 8px; max-width: 400px; width: 100%; padding: 24px;">
                <h2 style="color: white; font-size: 24px; font-weight: bold; margin-bottom: 16px; text-align: center;">ğŸ” Dev-Zugang</h2>
                <div style="margin-bottom: 16px;">
                    <input type="password" id="dev-password" placeholder="Dev-Passwort eingeben" style="width: 100%; padding: 8px 12px; border-radius: 6px; background: #4B5563; color: white; border: 1px solid #6B7280; outline: none;" onkeypress="if(event.key === 'Enter') loginDev()">
                </div>
                <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                    <button onclick="loginDev()" style="flex: 1; padding: 8px 16px; background: #2563EB; color: white; border-radius: 6px; border: none; cursor: pointer;">Anmelden</button>
                    <button onclick="closeDevLoginPopup()" style="flex: 1; padding: 8px 16px; background: #6B7280; color: white; border-radius: 6px; border: none; cursor: pointer;">Abbrechen</button>
                </div>
                <div style="color: #9CA3AF; font-size: 12px; text-align: center;">
                    ğŸ’¡ Nur fÃ¼r Entwickler mit entsprechenden Berechtigungen
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Note: Scripts are already loaded in the head section -->
    
    <script>
        // Note: Firebase and variables are already initialized in shared scripts
        
        // Dev tab functions
        window.showDevTab = function(tabName) {
            console.log('ğŸ”§ showDevTab called with:', tabName);
            
            // Hide all tabs
            document.querySelectorAll('.dev-tab').forEach(tab => {
                tab.classList.remove('active');
                tab.style.display = 'none';
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.mehr-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            const selectedTab = document.getElementById(tabName);
            if (selectedTab) {
                selectedTab.classList.add('active');
                selectedTab.style.display = 'block';
                console.log('âœ… Tab shown:', tabName);
            } else {
                console.error('âŒ Tab not found:', tabName);
            }
            
            // Add active class to clicked button
            const clickedBtn = document.querySelector(`[data-tab="${tabName}"]`);
            if (clickedBtn) {
                clickedBtn.classList.add('active');
                console.log('âœ… Button activated:', tabName);
            } else {
                console.error('âŒ Button not found:', tabName);
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ğŸ”§ Dev page loaded');
            
            // Initialize Dev status from Firebase
            if (typeof initializeDevStatus === 'function') {
                await initializeDevStatus();
                } else {
                // Fallback to local updateDevStatus
                updateDevStatus();
            }
            
            // Initialize Pool Wallet
            if (typeof initializePoolWallet === 'function') {
                initializePoolWallet();
            }
            
        // Auto-load dev drops for deletion
        setTimeout(() => {
            loadDevDropsForDeletion();
            // Update next filename display
            if (typeof updateNextFilenameDisplay === 'function') {
                updateNextFilenameDisplay();
            }
        }, 1000);
        
        // Define showMessage function if not available
        if (typeof showMessage === 'undefined') {
            window.showMessage = function(message, isError = false) {
                console.log(isError ? 'âŒ' : 'âœ…', message);
                // You can add UI notification here if needed
            };
        }
        
        // Define loadDevDropsForDeletion function if not available
        if (typeof loadDevDropsForDeletion === 'undefined') {
            window.loadDevDropsForDeletion = async function() {
                if (!window.isDevLoggedIn) {
                    showMessage('âŒ Dev-Modus erforderlich!', true);
                    return;
                }
                
                try {
                    console.log('ğŸ¯ Loading dev drops for deletion...');
                    
                    if (!window.db) {
                        showMessage('âŒ Firebase nicht verbunden!', true);
                        return;
                    }
                    
                    // Load Dev Drops from devDrops collection (like in GeoCard)
                    const devDropsSnapshot = await window.db.collection('devDrops').where('isAvailable', '==', true).get();
                    console.log('ğŸ¯ Loading Dev Drops from devDrops collection:', devDropsSnapshot.size, 'drops');
                    const select = document.getElementById('dev-drop-select');
                    
                    console.log('ğŸ¯ Found', devDropsSnapshot.size, 'dev drops');
                    
                    if (select) {
                        select.innerHTML = '<option value="">Dev Drop auswÃ¤hlen...</option>';
                        
                        if (devDropsSnapshot.empty) {
                            const option = document.createElement('option');
                            option.value = '';
                            option.textContent = 'Keine Dev Drops gefunden';
                            option.disabled = true;
                            select.appendChild(option);
                        } else {
                            devDropsSnapshot.forEach(doc => {
                                const data = doc.data();
                                const option = document.createElement('option');
                                option.value = doc.id;
                                option.textContent = `ğŸ¯ Dev GeoDrop${data.geodropNumber || doc.id} - ${data.reward || 100} PixelDrops (${data.lat?.toFixed(4) || 'N/A'}, ${data.lng?.toFixed(4) || 'N/A'})`;
                                select.appendChild(option);
                            });
                        }
                    }
                    
                    showMessage(`âœ… ${devDropsSnapshot.size} Dev Drops geladen`, false);
                } catch (error) {
                    console.error('âŒ Load dev drops error:', error);
                    showMessage('âŒ Fehler beim Laden der Dev Drops!', true);
                }
            };
        }
            
            // Update navigation icons
            if (typeof updateNavigationDevStatus === 'function') {
                updateNavigationDevStatus();
            }
            
            // Show main tab by default
            setTimeout(() => {
                showDevTab('dev-main');
            }, 100);
        });
        
        
        // Note: updateDevStatus is now loaded from dev-functions.js
    </script>
</body>
</html>
</html>