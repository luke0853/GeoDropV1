// Language Management System for GeoDrop
// Sprachverwaltungssystem für GeoDrop

// Language translations / Sprachübersetzungen
const translations = {
    de: {
        // Navigation
        'navigation.mehr': 'Mehr',
        'navigation.dashboard': '🏠 Dashboard',
        'navigation.profile': '👤 Profil',
        'navigation.settings': '⚙️ Einstellungen',
        'navigation.stats': '📊 Statistiken',
        'navigation.guide': '📖 Leitfaden',
        'navigation.impressum': 'ℹ️ Impressum',
        'navigation.dev': '🔧 Dev',
        
        // Dashboard
        'dashboard.title': '🏠 Dashboard',
        'dashboard.your-stats': '📊 Deine Statistiken',
        'dashboard.pixeldrop-balance': 'PixelDrop Balance:',
        'dashboard.tbnb-balance': 'tBNB Balance:',
        'dashboard.geodrops-collected': 'GeoDrops gesammelt:',
        'dashboard.mining-boost': 'Mining Boost:',
        'dashboard.today-activity': '🎯 Heutige Aktivität',
        'dashboard.geodrops-today': 'GeoDrops heute:',
        'dashboard.pixeldrop-earned': 'PixelDrop verdient:',
        'dashboard.mining-time': 'Mining Zeit:',
        'dashboard.pixeldrop-payout': '💸 PixelDrop Auszahlung',
        'dashboard.available-app': 'Verfügbare PixelDrop (App):',
        'dashboard.available-blockchain': 'Verfügbare PixelDrop (Blockchain):',
        'dashboard.payout': 'Auszahlung:',
        'dashboard.real-blockchain': 'Echte Blockchain-Transaktion',
        'dashboard.wallet-address': 'Wallet-Adresse für Auszahlung:',
        'dashboard.amount-to-withdraw': 'Auszuzahlende PixelDrop:',
        'dashboard.max': 'Max',
        'dashboard.amount-to-pay': 'Auszuzahlender Betrag:',
        'dashboard.calculate': '💰 Berechnen',
        'dashboard.withdraw': '💸 Auszahlen',
        'dashboard.min-withdrawal': '💡 Mindestauszahlung: 100 PixelDrop',
        
        // Settings
        'settings.title': '⚙️ Einstellungen',
        'settings.username': '👤 Benutzername',
        'settings.username-label': 'Benutzername:',
        'settings.save': '💾 Speichern',
        'settings.username-tip': '💡 Tipp: Der Benutzername ersetzt deine E-Mail-Adresse im Spiel',
        'settings.email-settings': '📧 E-Mail Einstellungen',
        'settings.current-email': 'Aktuelle E-Mail:',
        'settings.new-email': 'Neue E-Mail:',
        'settings.confirm-password': 'Passwort bestätigen:',
        'settings.update-email': '📧 E-Mail aktualisieren',
        'settings.notifications': '🔔 Benachrichtigungen',
        'settings.email-notifications': 'E-Mail Benachrichtigungen',
        'settings.push-notifications': 'Push Benachrichtigungen',
        'settings.daily-updates': 'Tägliche Updates',
        'settings.save-settings': '💾 Einstellungen speichern',
        'settings.language': '🌍 Sprache / Language',
        'settings.current-language': 'Aktuelle Sprache / Current Language:',
        'settings.select-language': 'Sprache wählen / Select Language:',
        'settings.change-language': '🌍 Sprache ändern / Change Language',
        'settings.language-tip': '💡 Die Sprache wird sofort geändert und gespeichert / Language will be changed and saved immediately',
        
        // Profile
        'profile.title': '👤 Profil',
        'profile.username': 'Benutzername:',
        'profile.email': 'E-Mail:',
        'profile.user-id': 'Benutzer-ID:',
        'profile.registration': 'Registrierung:',
        'profile.coins': 'PixelDrop:',
        'profile.drops': 'GeoDrops:',
        'profile.today-drops': 'Heute GeoDrops:',
        'profile.today-coins': 'Heute PixelDrop:',
        'profile.mining-boost': 'Mining Boost:',
        'profile.referral-code': 'Empfehlungscode:',
        
        // Stats
        'stats.title': '📊 Statistiken',
        'stats.total-drops': 'Gesamte GeoDrops:',
        'stats.total-earnings': 'Gesamte Einnahmen:',
        'stats.user-level': 'Benutzer Level:',
        'stats.mining-machines': 'Mining Maschinen:',
        'stats.bonus-claimed': 'Bonus erhalten:',
        'stats.current-balance': 'Aktuelle Balance:',
        'stats.first-login': 'Erste Anmeldung:',
        'stats.last-activity': 'Letzte Aktivität:',
        'stats.total-referrals': 'Gesamte Empfehlungen:',
        'stats.today-drops': 'Heute GeoDrops:',
        'stats.today-earnings': 'Heute Einnahmen:',
        
        // Common
        'common.loading': 'Lädt...',
        'common.error': 'Fehler',
        'common.success': 'Erfolgreich',
        'common.cancel': 'Abbrechen',
        'common.ok': 'OK',
        'common.yes': 'Ja',
        'common.no': 'Nein',
        'common.save': 'Speichern',
        'common.delete': 'Löschen',
        'common.edit': 'Bearbeiten',
        'common.close': 'Schließen',
        'common.not-available': 'Nicht verfügbar'
    },
    
    en: {
        // Navigation
        'navigation.mehr': 'More',
        'navigation.dashboard': '🏠 Dashboard',
        'navigation.profile': '👤 Profile',
        'navigation.settings': '⚙️ Settings',
        'navigation.stats': '📊 Statistics',
        'navigation.guide': '📖 Guide',
        'navigation.impressum': 'ℹ️ Legal',
        'navigation.dev': '🔧 Dev',
        
        // Dashboard
        'dashboard.title': '🏠 Dashboard',
        'dashboard.your-stats': '📊 Your Statistics',
        'dashboard.pixeldrop-balance': 'PixelDrop Balance:',
        'dashboard.tbnb-balance': 'tBNB Balance:',
        'dashboard.geodrops-collected': 'GeoDrops Collected:',
        'dashboard.mining-boost': 'Mining Boost:',
        'dashboard.today-activity': '🎯 Today\'s Activity',
        'dashboard.geodrops-today': 'GeoDrops Today:',
        'dashboard.pixeldrop-earned': 'PixelDrop Earned:',
        'dashboard.mining-time': 'Mining Time:',
        'dashboard.pixeldrop-payout': '💸 PixelDrop Withdrawal',
        'dashboard.available-app': 'Available PixelDrop (App):',
        'dashboard.available-blockchain': 'Available PixelDrop (Blockchain):',
        'dashboard.payout': 'Withdrawal:',
        'dashboard.real-blockchain': 'Real Blockchain Transaction',
        'dashboard.wallet-address': 'Wallet Address for Withdrawal:',
        'dashboard.amount-to-withdraw': 'PixelDrop to Withdraw:',
        'dashboard.max': 'Max',
        'dashboard.amount-to-pay': 'Amount to Withdraw:',
        'dashboard.calculate': '💰 Calculate',
        'dashboard.withdraw': '💸 Withdraw',
        'dashboard.min-withdrawal': '💡 Minimum withdrawal: 100 PixelDrop',
        
        // Settings
        'settings.title': '⚙️ Settings',
        'settings.username': '👤 Username',
        'settings.username-label': 'Username:',
        'settings.save': '💾 Save',
        'settings.username-tip': '💡 Tip: The username replaces your email address in the game',
        'settings.email-settings': '📧 Email Settings',
        'settings.current-email': 'Current Email:',
        'settings.new-email': 'New Email:',
        'settings.confirm-password': 'Confirm Password:',
        'settings.update-email': '📧 Update Email',
        'settings.notifications': '🔔 Notifications',
        'settings.email-notifications': 'Email Notifications',
        'settings.push-notifications': 'Push Notifications',
        'settings.daily-updates': 'Daily Updates',
        'settings.save-settings': '💾 Save Settings',
        'settings.language': '🌍 Sprache / Language',
        'settings.current-language': 'Aktuelle Sprache / Current Language:',
        'settings.select-language': 'Sprache wählen / Select Language:',
        'settings.change-language': '🌍 Sprache ändern / Change Language',
        'settings.language-tip': '💡 Die Sprache wird sofort geändert und gespeichert / Language will be changed and saved immediately',
        
        // Profile
        'profile.title': '👤 Profile',
        'profile.username': 'Username:',
        'profile.email': 'Email:',
        'profile.user-id': 'User ID:',
        'profile.registration': 'Registration:',
        'profile.coins': 'PixelDrop:',
        'profile.drops': 'GeoDrops:',
        'profile.today-drops': 'Today GeoDrops:',
        'profile.today-coins': 'Today PixelDrop:',
        'profile.mining-boost': 'Mining Boost:',
        'profile.referral-code': 'Referral Code:',
        
        // Stats
        'stats.title': '📊 Statistics',
        'stats.total-drops': 'Total GeoDrops:',
        'stats.total-earnings': 'Total Earnings:',
        'stats.user-level': 'User Level:',
        'stats.mining-machines': 'Mining Machines:',
        'stats.bonus-claimed': 'Bonus Claimed:',
        'stats.current-balance': 'Current Balance:',
        'stats.first-login': 'First Login:',
        'stats.last-activity': 'Last Activity:',
        'stats.total-referrals': 'Total Referrals:',
        'stats.today-drops': 'Today GeoDrops:',
        'stats.today-earnings': 'Today Earnings:',
        
        // Common
        'common.loading': 'Loading...',
        'common.error': 'Error',
        'common.success': 'Success',
        'common.cancel': 'Cancel',
        'common.ok': 'OK',
        'common.yes': 'Yes',
        'common.no': 'No',
        'common.save': 'Save',
        'common.delete': 'Delete',
        'common.edit': 'Edit',
        'common.close': 'Close',
        'common.not-available': 'Not available'
    }
};

// Current language / Aktuelle Sprache
let currentLanguage = 'de';

// Initialize language system / Sprachsystem initialisieren
function initLanguageSystem() {
    console.log('🌍 Initializing language system...');
    
    // Load saved language from localStorage
    const savedLanguage = localStorage.getItem('geodrop-language');
    if (savedLanguage && translations[savedLanguage]) {
        currentLanguage = savedLanguage;
        console.log('✅ Loaded saved language:', currentLanguage);
    } else {
        console.log('✅ Using default language:', currentLanguage);
    }
    
    // Update UI language
    updateLanguageDisplay();
    applyLanguage();
    
    console.log('✅ Language system initialized');
}

// Get translation for a key / Übersetzung für einen Schlüssel abrufen
function t(key) {
    const translation = translations[currentLanguage] && translations[currentLanguage][key];
    if (translation) {
        return translation;
    }
    
    // Fallback to German if English translation not found
    const fallback = translations['de'] && translations['de'][key];
    if (fallback) {
        console.warn(`⚠️ Translation missing for '${key}' in '${currentLanguage}', using German fallback`);
        return fallback;
    }
    
    // Return key if no translation found
    console.warn(`⚠️ Translation missing for '${key}' in both languages`);
    return key;
}

// Change language / Sprache ändern
window.changeLanguage = function() {
    console.log('🌍 Changing language...');
    
    const selector = document.getElementById('language-selector');
    if (!selector) {
        console.error('❌ Language selector not found');
        return;
    }
    
    const newLanguage = selector.value;
    if (!translations[newLanguage]) {
        console.error('❌ Invalid language:', newLanguage);
        return;
    }
    
    console.log('🔄 Changing from', currentLanguage, 'to', newLanguage);
    
    // Update current language
    currentLanguage = newLanguage;
    
    // Save to localStorage
    localStorage.setItem('geodrop-language', currentLanguage);
    console.log('💾 Language saved to localStorage:', currentLanguage);
    
    // Update UI
    updateLanguageDisplay();
    applyLanguage();
    
    // Show success message
    const message = currentLanguage === 'de' ? 
        '✅ Sprache erfolgreich geändert!' : 
        '✅ Language changed successfully!';
    
    if (typeof window.showMessage === 'function') {
        window.showMessage(message);
    } else {
        alert(message);
    }
    
    console.log('✅ Language changed to:', currentLanguage);
};

// Update language display in settings / Sprachanzeige in Einstellungen aktualisieren
function updateLanguageDisplay() {
    console.log('🔄 Updating language display...');
    
    // Update current language display
    const currentLangElement = document.getElementById('current-language');
    if (currentLangElement) {
        currentLangElement.textContent = currentLanguage === 'de' ? 'Deutsch' : 'English';
    }
    
    // Update language selector
    const selector = document.getElementById('language-selector');
    if (selector) {
        selector.value = currentLanguage;
    }
    
    console.log('✅ Language display updated');
}

// Apply language to UI elements / Sprache auf UI-Elemente anwenden
function applyLanguage() {
    console.log('🌍 Applying language to UI elements...');
    
    // Apply translations to elements with data-lang attribute
    const elements = document.querySelectorAll('[data-lang]');
    let updatedCount = 0;
    
    elements.forEach(element => {
        const key = element.getAttribute('data-lang');
        const translation = t(key);
        
        if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
            if (element.type === 'button' || element.type === 'submit') {
                element.value = translation;
            } else {
                element.placeholder = translation;
            }
        } else {
            element.textContent = translation;
        }
        
        updatedCount++;
    });
    
    console.log(`✅ Applied language to ${updatedCount} elements`);
    
    // Update specific elements by their content (if they don't have data-lang)
    updateSpecificElements();
}

// Update specific elements that don't have data-lang attributes
function updateSpecificElements() {
    // Update tab buttons
    const tabButtons = document.querySelectorAll('.mehr-tab-btn');
    tabButtons.forEach(btn => {
        const tabId = btn.getAttribute('data-tab');
        if (tabId) {
            const key = `navigation.${tabId}`;
            const translation = t(key);
            // Only update the text, keep the emoji
            const currentText = btn.textContent || btn.innerText;
            const emoji = currentText.split(' ')[0]; // Get first part (emoji)
            btn.innerHTML = `${emoji} ${translation.split(' ').slice(1).join(' ')}`;
        }
    });
    
    // Update page titles when tabs are loaded
    updatePageTitles();
}

// Update page titles / Seitentitel aktualisieren
function updatePageTitles() {
    // Update dashboard title
    const dashboardTitle = document.querySelector('h3[class*="text-2xl"]');
    if (dashboardTitle && dashboardTitle.textContent.includes('Dashboard')) {
        dashboardTitle.textContent = t('dashboard.title');
    }
    
    // Update settings title
    const settingsTitle = document.querySelector('h3[class*="text-2xl"]');
    if (settingsTitle && settingsTitle.textContent.includes('Einstellungen')) {
        settingsTitle.textContent = t('settings.title');
    }
}

// Get current language / Aktuelle Sprache abrufen
window.getCurrentLanguage = function() {
    return currentLanguage;
};

// Set language programmatically / Sprache programmatisch setzen
window.setLanguage = function(language) {
    if (!translations[language]) {
        console.error('❌ Invalid language:', language);
        return false;
    }
    
    currentLanguage = language;
    localStorage.setItem('geodrop-language', currentLanguage);
    updateLanguageDisplay();
    applyLanguage();
    
    console.log('✅ Language set to:', currentLanguage);
    return true;
};

// Force refresh language / Sprache forciert aktualisieren
window.refreshLanguage = function() {
    console.log('🔄 Force refreshing language...');
    applyLanguage();
    updateLanguageDisplay();
    console.log('✅ Language refreshed');
};

// Auto-initialize on load / Auto-Initialisierung beim Laden
document.addEventListener('DOMContentLoaded', function() {
    initLanguageSystem();
});

// Also initialize immediately if DOM is already ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initLanguageSystem);
} else {
    initLanguageSystem();
}

// Expose for global access / Für globalen Zugriff bereitstellen
window.t = t;
window.initLanguageSystem = initLanguageSystem;
window.applyLanguage = applyLanguage;
window.updateLanguageDisplay = updateLanguageDisplay;

console.log('✅ Language system loaded');
