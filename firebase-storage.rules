rules_version = '2';

// Firebase Storage Rules for GeoDrop
// Extends temporary rules (expires September 21, 2025)
service firebase.storage {
  match /b/{bucket}/o {
    
    // REFERENZBILDER_USERDROP FOLDER
    // Allows uploads in referenzbilder_userdrop/ for all users
    match /referenzbilder_userdrop/{allPaths=**} {
      // Allows read and write access for all (temporary for testing)
      allow read, write: if true;
      
      // TODO: Later restrict to authenticated users:
      // allow read, write: if request.auth != null;
    }
    
    // REFERENZBILDER FOLDER (Dev Images)
    // Allows uploads in referenzbilder/ for Dev users
    match /referenzbilder/{allPaths=**} {
      // Allows read and write access for all (temporary for testing)
      allow read, write: if true;
      
      // TODO: Later restrict to Dev users:
      // allow read, write: if request.auth != null && 
      //   (request.auth.token.dev === true || request.auth.token.admin === true);
    }
    
    // USER_UPLOADS FOLDER
    // Allows uploads in user_uploads/ for authenticated users
    match /user_uploads/{allPaths=**} {
      // Allows read and write access for all (temporary for testing)
      allow read, write: if true;
      
      // TODO: Later restrict to authenticated users:
      // allow read, write: if request.auth != null;
    }
    
    // USER_UPLOADS(USERDROP) FOLDER
    // Allows uploads in user_uploads(userdrop)/ for authenticated users
    match /user_uploads(userdrop)/{allPaths=**} {
      // Allows read and write access for all (temporary for testing)
      allow read, write: if true;
      
      // TODO: Later restrict to authenticated users:
      // allow read, write: if request.auth != null;
    }
    
    // FALLBACK: ALL OTHER FILES
    // Extends temporary rules (until September 21, 2025)
    match /{allPaths=**} {
      allow read, write: if request.time < timestamp.date(2025, 9, 21);
    }
  }
}
