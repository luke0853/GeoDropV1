rules_version = '2';

// Firebase Storage Rules for GeoDrop
// Extends temporary rules (expires September 21, 2025)
service firebase.storage {
  match /b/{bucket}/o {
    
    // REFERENZBILDER_USERDROP FOLDER
    // Allows uploads in referenzbilder_userdrop/ for authenticated users only
    match /referenzbilder_userdrop/{allPaths=**} {
      // SECURITY FIX: Only authenticated users can access
      allow read, write: if request.auth != null;
    }
    
    // REFERENZBILDER FOLDER (Dev Images)
    // Allows uploads in referenzbilder/ for Dev users only
    match /referenzbilder/{allPaths=**} {
      // SECURITY FIX: Only authenticated users can access
      allow read, write: if request.auth != null;
    }
    
    // USER_UPLOADS FOLDER
    // Allows uploads in user_uploads/ for authenticated users only
    match /user_uploads/{allPaths=**} {
      // SECURITY FIX: Only authenticated users can access
      allow read, write: if request.auth != null;
    }
    
    // USER_UPLOADS_USERDROP FOLDER
    // Allows uploads in user_uploads_userdrop/ for authenticated users only
    match /user_uploads_userdrop/{allPaths=**} {
      // SECURITY FIX: Only authenticated users can access
      allow read, write: if request.auth != null;
    }
    
    // GEODROPS FOLDER (Dev Uploads)
    // Allows uploads in geodrops/ for authenticated users only
    match /geodrops/{allPaths=**} {
      // SECURITY FIX: Only authenticated users can access
      allow read, write: if request.auth != null;
    }
    
    // FALLBACK: ALL OTHER FILES
    // Extends temporary rules (until December 31, 2025)
    match /{allPaths=**} {
      allow read, write: if request.time < timestamp.date(2025, 12, 31);
    }
  }
}
